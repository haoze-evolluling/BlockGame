# Clumsy é›†æˆä¿®å¤è¯´æ˜

## é—®é¢˜è¯Šæ–­

åŸé—®é¢˜ï¼šclumsy æ²¡æœ‰è¢«æ­£ç¡®è°ƒç”¨

æ ¹æœ¬åŸå› ï¼š
1. clumsy.exe åœ¨ `clumsy/` æ–‡ä»¶å¤¹ä¸­ï¼Œè€Œä¸æ˜¯é¡¹ç›®æ ¹ç›®å½•
2. clumsy éœ€è¦ä¾èµ–æ–‡ä»¶ï¼ˆWinDivert.dllã€WinDivert64.sysï¼‰åœ¨åŒä¸€ç›®å½•
3. ä»£ç æ²¡æœ‰æ­£ç¡®å¤„ç† clumsy æ–‡ä»¶å¤¹è·¯å¾„
4. å¯åŠ¨ clumsy æ—¶æ²¡æœ‰è®¾ç½®å·¥ä½œç›®å½•ï¼ˆcwdï¼‰

## å·²ä¿®å¤çš„é—®é¢˜

### 1. è·¯å¾„æŸ¥æ‰¾é€»è¾‘ âœ…

ä¿®æ”¹äº† `_get_clumsy_path()` æ–¹æ³•ï¼Œæ”¯æŒå¤šä¸ªè·¯å¾„æŸ¥æ‰¾ï¼š
- `clumsy/clumsy.exe` ï¼ˆæ–‡ä»¶å¤¹ä¸­ï¼‰
- `clumsy.exe` ï¼ˆæ ¹ç›®å½•ï¼‰
- æ”¯æŒ PyInstaller æ‰“åŒ…åçš„è·¯å¾„

### 2. å·¥ä½œç›®å½•è®¾ç½® âœ…

æ·»åŠ äº† `_get_clumsy_dir()` æ–¹æ³•ï¼Œå¹¶åœ¨å¯åŠ¨ clumsy æ—¶è®¾ç½® `cwd` å‚æ•°ï¼š
```python
self.clumsy_process = subprocess.Popen(
    cmd,
    cwd=clumsy_dir,  # å…³é”®ï¼šåœ¨clumsyç›®å½•ä¸‹è¿è¡Œ
    startupinfo=startupinfo,
    creationflags=subprocess.CREATE_NO_WINDOW
)
```

### 3. æ‰“åŒ…é…ç½® âœ…

æ›´æ–°äº† `build.spec`ï¼Œæ‰“åŒ…æ•´ä¸ª clumsy æ–‡ä»¶å¤¹ï¼š
```python
datas=[
    ('frontend/index.html', 'frontend'),
    ('clumsy/clumsy.exe', 'clumsy'),
    ('clumsy/WinDivert.dll', 'clumsy'),
    ('clumsy/WinDivert64.sys', 'clumsy'),
]
```

### 4. æ„å»ºæ£€æŸ¥ âœ…

æ›´æ–°äº† `build.py`ï¼Œåœ¨æ‰“åŒ…å‰æ£€æŸ¥æ‰€æœ‰å¿…éœ€æ–‡ä»¶ï¼š
- clumsy/clumsy.exe
- clumsy/WinDivert.dll
- clumsy/WinDivert64.sys

## æµ‹è¯•ç»“æœ

âœ… æµ‹è¯•é€šè¿‡ï¼è¿è¡Œ `python test_clumsy.py` æˆåŠŸï¼š

```
ğŸ§ª æµ‹è¯•clumsyé›†æˆ

Clumsyè·¯å¾„: C:\Users\...\BlockGame\clumsy\clumsy.exe
âœ… æ‰¾åˆ°clumsy.exe

æµ‹è¯•è®¾ç½®50%ä¸¢åŒ…...
ç»“æœ: å·²è®¾ç½®ä¸¢åŒ…ç‡ä¸º 50%ï¼ˆä½¿ç”¨clumsyï¼‰
âœ… æˆåŠŸå¯åŠ¨clumsy
```

## æ–‡ä»¶ç»“æ„

æ­£ç¡®çš„é¡¹ç›®ç»“æ„ï¼š
```
é¡¹ç›®ç›®å½•/
â”œâ”€â”€ clumsy/                    â† clumsyæ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ clumsy.exe            â† ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ WinDivert.dll         â† ä¾èµ–æ–‡ä»¶
â”‚   â”œâ”€â”€ WinDivert64.sys       â† ä¾èµ–æ–‡ä»¶
â”‚   â””â”€â”€ config.txt            â† é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ server.py
â”‚   â””â”€â”€ network_control.py
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ index.html
â””â”€â”€ ...
```

## æµ‹è¯•æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•
```bash
python test_clumsy.py
```

### å®Œæ•´æµ‹è¯•ï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰
```bash
python test_all_modes.py
```
æˆ–åŒå‡»è¿è¡Œ `å¿«é€Ÿæµ‹è¯•.bat`

### æµ‹è¯•Webç•Œé¢
```bash
python backend/server.py
```
ç„¶åè®¿é—® `http://localhost:5000`

## ä¸‹ä¸€æ­¥

ç°åœ¨å¯ä»¥æ­£å¸¸æ‰“åŒ…äº†ï¼š

1. æ‰“åŒ…ç¨‹åºï¼š
```bash
python build.py
```

2. å®‰è£…ç¨‹åºï¼š
```bash
python installer.py
```

æˆ–è€…ä¸€é”®å®Œæˆï¼š
```bash
ä¸€é”®æ‰“åŒ…å®‰è£….bat
```

## æŠ€æœ¯ç»†èŠ‚

### Clumsy å¯åŠ¨å‚æ•°
```
--filter "outbound or inbound"  # å½±å“åŒå‘æµé‡
--drop on                        # å¯ç”¨ä¸¢åŒ…
--drop-chance 50                 # 50%ä¸¢åŒ…ç‡
```

### éšè—çª—å£
ä½¿ç”¨ Windows API æ ‡å¿—ï¼š
- `STARTF_USESHOWWINDOW`
- `SW_HIDE`
- `CREATE_NO_WINDOW`

### è¿›ç¨‹ç®¡ç†
- åˆ‡æ¢æ¨¡å¼æ—¶è‡ªåŠ¨åœæ­¢æ—§çš„ clumsy è¿›ç¨‹
- ç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†
- ä½¿ç”¨ psutil æŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹

## æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦æç¤º**ï¼š
1. clumsy éœ€è¦ç®¡ç†å‘˜æƒé™
2. å¿…é¡»ä¿æŒ clumsy æ–‡ä»¶å¤¹å®Œæ•´ï¼ˆåŒ…å«ä¾èµ–æ–‡ä»¶ï¼‰
3. é˜²ç«å¢™å¯èƒ½éœ€è¦å…è®¸ clumsy è®¿é—®ç½‘ç»œ
4. 50% ä¸¢åŒ…ä¼šæ˜æ˜¾å½±å“ç½‘ç»œä½“éªŒ
